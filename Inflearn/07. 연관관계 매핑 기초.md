# 연관관계 매핑 기초
- 객체와 테이블의 연관관계 차이를 이해
- 객체의 참조와 테이블의 외래 키를 매핑

## 용어를 알아야 연관관계 매핑 시 이해가 가능
- __방향 (Direction)__ : 단방향, 양방향
- __다중성 (Multiplicity)__ : 다대일, 일대다, 일대일
- __연관관계의 주인 (Owner)__ : 객체의 양방향 연관관계 관리

## 연관관계가 필요한 이유는 ?
> 객체지향 설계의 목표는 자율적인 객체들의 협력 공동체를 만드는 것이다.

## 예제 시나리오
- 회원과 팀이 있다.
- 회원은 하나의 팀에만 소속될 수 있다.
- 회원과 팀은 다대일 관계에 있다.

## 객체를 테이블에 맞추어 모델링 (비객체지향 방법)
- 외래키 식별자를 직접 사용
- 객체에 대한 참조를 사용하지 않는다.

> 객체를 테이블에 맞추어 설계 및 모델링을 하게되면, 협력관계를 만들 수 없다.
- 테이블은 외래키로 조인을 한다.
- 객체는 참조를 사용하여 연관된 객체를 찾는다.
- __테이블과 객체 사이에 큰 간극이 존재__ 한다.
   
   
# 단방향 연관관계

### Member
```java
@Getter
@Entity
@Table(name = "member")
@NoArgsConstructor(access = AccessLevel.PROTECTED)
@ToString(exclude = "team")
public class Member {

    @Id
    @GeneratedValue(strategy = GenerationType.IDENTITY)
    private Long id;

    @Column(name = "name", length = 45, nullable = false)
    private String name;

    @ManyToOne(fetch = FetchType.LAZY)
    @JoinColumn(name = "team_id", referencedColumnName = "id", nullable = false)
    private Team team;

    @Builder
    private Member(String name, Team team){
        this.name = name;
        this.team = team;
    }
}
```

### Team
```java
@Getter
@Entity
@Table(name = "team")
@NoArgsConstructor(access = AccessLevel.PROTECTED)
@ToString
public class Team {

    @Id
    @GeneratedValue(strategy = GenerationType.IDENTITY)
    private Long id;

    @Column(name = "name", length = 45)
    private String name;

    @Builder
    public Team(String name){
        this.name = name;
    }

}
```
   
   
# 양방향 연관관계
- __연관관계의 주인이 중요__
  - 객체와 테이블 패러다임의 차이.
  - 객체는 참조를 사용
  - 테이블은 외래키 조인을 사용

### Team 객체에 mappedBy 속성을 아래와 같이 추가
```java
@Getter
@Entity
@Table(name = "team")
@NoArgsConstructor(access = AccessLevel.PROTECTED)
@ToString
public class Team {

    @Id
    @GeneratedValue(strategy = GenerationType.IDENTITY)
    private Long id;

    @Column(name = "name", length = 45)
    private String name;

    @OneToMany(mappedBy = "team", fetch = FetchType.LAZY)
    private List<Member> members = new ArrayList<>();

    @Builder
    public Team(String name){
        this.name = name;
    }

}
```

> 객체와 테이블의 연관관계를 맺는 방식의 차이를 이해하는 것이 중요.
- (1) 객체는 회원에서 팀으로 가는 연관관계 (단방향)
- (2) 객체는 팀에서 회원으로 가는 연관관계 (단방향)
- (3) (1), (2) 을 합쳤을 때, __결국 단방향 두 개를 합쳤을 때 양방향이 되는 것__ 이다.
